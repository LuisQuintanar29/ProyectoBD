CREATE DATABASE papeleria;

DROP TABLE IF EXISTS cliente CASCADE;
DROP TABLE IF EXISTS compa単ia CASCADE;
DROP TABLE IF EXISTS consumo CASCADE;
DROP TABLE IF EXISTS email CASCADE;
DROP TABLE IF EXISTS impresion CASCADE;
DROP TABLE IF EXISTS inventario CASCADE;
DROP TABLE IF EXISTS preciorecarga CASCADE;
DROP TABLE IF EXISTS producto CASCADE;
DROP TABLE IF EXISTS proveedor CASCADE;
DROP TABLE IF EXISTS recarga CASCADE;
DROP TABLE IF EXISTS tama単ohoja CASCADE;
DROP TABLE IF EXISTS telefono CASCADE;
DROP TABLE IF EXISTS tipoimpresion CASCADE;
DROP TABLE IF EXISTS tipoproducto CASCADE;

CREATE TABLE cliente(
RFC varchar(13) NOT NULL,
NombreCliente varchar(70) NOT NULL ,
EstadoCliente varchar(70) NOT NULL,
ColoniaCliente varchar(70) NOT NULL,
CalleCliente varchar(70) NOT NULL,
CPCliente int NOT NULL,
NumeroCliente int NOT NULL,
CONSTRAINT cliente_PK PRIMARY KEY (RFC)
);

CREATE TABLE email(
Email varchar(50) NOT NULL,
RFC varchar(13) NOT NULL,
CONSTRAINT email_PK PRIMARY KEY (Email),
CONSTRAINT email_cliente_FK FOREIGN KEY (RFC) REFERENCES cliente(RFC) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE proveedor(
RazonSocial varchar(30) NOT NULL,
NombreProv varchar(70) NOT NULL,
EstadoProv varchar(70) NOT NULL,
ColoniaProv varchar(70) NOT NULL,
CalleProv varchar(70) NOT NULL,
CPProv int NOT NULL,
NumeroProv int NOT NULL,
CONSTRAINT proveedor_PK PRIMARY KEY (RazonSocial)
);

CREATE TABLE telefono(
Telefono int NOT NULL,
RazonSocial varchar(30) NOT NULL,
CONSTRAINT telefono_PK PRIMARY KEY (Telefono),
CONSTRAINT telefono_proveedor_FK FOREIGN KEY (RazonSocial) REFERENCES proveedor (RazonSocial) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE inventario(
CodigoBarras bigint NOT NULL,
PrecioCompra int NOT NULL,
FechaCompra date NOT NULL,
Stock int NOT NULL,
CONSTRAINT inventario_PK PRIMARY KEY (CodigoBarras)
);

CREATE TABLE tipoproducto(
IDTipoProd serial,
TipoProducto varchar(30) NOT NULL,
CONSTRAINT tipoproducto_PK PRIMARY KEY (IDTipoProd)
);

CREATE TABLE producto(
CodigoBarras bigint NOT NULL,
PrecioProd int NOT NULL,
Marca varchar(15) NOT NULL,
DescripcionProd varchar(30) NOT NULL,
IDTipoProd int NOT NULL,
CONSTRAINT producto_PK PRIMARY KEY (CodigoBarras),
CONSTRAINT productoCodBar_inventario_FK FOREIGN KEY (CodigoBarras) REFERENCES inventario (CodigoBarras) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT producto_tipoproducto_FK FOREIGN KEY (IDTipoProd) REFERENCES tipoproducto (IDTipoProd) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE impresion(
IDImpresion serial,
Tama単oHoja varchar(15) NOT NULL,
TipoImpresion varchar(15) NOT NULL,
PrecioServ int NOT NULL,
DescripcionServ varchar(30) NOT NULL,
CONSTRAINT impresion_PK PRIMARY KEY (IDImpresion)
);

CREATE TABLE recarga(
IDRecarga serial,
Compa単ia varchar(30) NOT NULL,
PrecioRecarga int NOT NULL,
DescripcionServ varchar(30) NOT NULL,
CONSTRAINT recarga_PK PRIMARY KEY (IDRecarga)
);

CREATE TABLE consumo(
NoVenta serial,
FechaVenta date NOT NULL,
CantidadArticulo int NOT NULL,
PrecioArticulo int NOT NULL,
CodigoBarras bigint,
IDImpresion int,
IDRecarga int,
Total int GENERATED ALWAYS AS (CantidadArticulo*PrecioArticulo) STORED,
CONSTRAINT consumo_PK PRIMARY KEY (NoVenta),
CONSTRAINT consumoCodBar_inventario_FK FOREIGN KEY (CodigoBarras) REFERENCES inventario (CodigoBarras) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT consumo_Impresion_FK FOREIGN KEY (IDImpresion) REFERENCES impresion (IDImpresion) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT consumo_recarga_FK FOREIGN KEY (IDRecarga) REFERENCES recarga (IDRecarga) ON DELETE CASCADE ON UPDATE CASCADE
);
